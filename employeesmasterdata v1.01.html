<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Arfa Foods</title>
  <link rel="icon" href="logo1.0.00.jpg" type="image/jpg">
<style>
  * {
    box-sizing: border-box;
  }

  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 40px 20px;
    background-color: #f4f6f8;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
  }

  h1, h2, h3 {
    color: #333;
    margin-bottom: 10px;
  }

  #modeBanner {
    padding: 10px 20px;
    border-radius: 6px;
    color: white;
    font-weight: bold;
    margin-bottom: 15px;
  }

  #employeeFormContainer {
    background-color: #fff;
    padding: 30px 25px;
    border: 1px solid #ddd;
    border-radius: 10px;
    max-width: 700px;
    width: 100%;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    margin-bottom: 25px;
  }

  input, textarea, select {
    width: 100%;
    padding: 10px;
    font-size: 15px;
    margin-bottom: 15px;
    border: 1px solid #ccc;
    border-radius: 6px;
  }

  button, .btn {
    background-color: #007BFF;
    border: none;
    color: white;
    font-size: 14px;
    padding: 10px 16px;
    border-radius: 6px;
    cursor: pointer;
    margin: 5px 3px 0 0;
  }

  .btn:hover, button:hover {
    background-color: #0056b3;
  }

  .table-container {
    width: 100vw;
    overflow-x: auto;
    margin-top: 25px;
    background-color: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    padding-bottom: 5px;
  }

  table {
    width: 205%;
    border-collapse: collapse;
  }

  th, td {
    border: 1px solid #ccc;
    padding: 8px;
    text-align: left;
    word-break: break-word;
  }

  th {
    background-color: #a53838;
    color: white;
    text-align: center;
    position: sticky;
    top: 0;
    z-index: 2;
  }

  .hidden { display: none; }
</style>
</head>
<body>

  <div id="modeBanner"></div>
  <h1>Employee Master Data</h1>
  <button id="showFormBtn" class="btn" onclick="showEmployeeForm()">Add New Employee</button>

  <div id="employeeFormContainer" class="hidden">
    <form id="employeeForm">
      <input type="number" id="srno" placeholder="Sr No" required>
      <input type="number" id="empid" placeholder="Emp ID" required>
      <input type="text" id="name" placeholder="Name" required>
      <input type="text" id="fathername" placeholder="Father Name" required>
      <input type="text" id="education" placeholder="Education" required>
      <input type="text" id="department" placeholder="Department" required>
      <input type="text" id="dateofbirth" placeholder="Date of Birth" required>
      <input type="text" id="cnic" maxlength="15" placeholder="CNIC (12345-1234567-1)" required>
      <input type="text" id="fathercnic" maxlength="15" placeholder="Father CNIC (12345-1234567-1)" required>
      <input type="text" id="empcurrentaddress" placeholder="Current Address" required>
      <input type="text" id="empparmaddress" placeholder="Permanent Address" required>
      <input type="number" id="empcontactno" placeholder="Contact No" required>
      <input type="number" id="empfatherno" placeholder="Parent Contact No" required>
      <input type="text" id="maritialstatus" placeholder="Marital Status" required>
      <input type="number" id="familycount" placeholder="Family Count" required>
      <input type="text" id="fatherjob" placeholder="Father's Occupation" required>
      <input type="text" id="emppreviousjob" placeholder="Previous Job" required>
      <input type="text" id="referenceby" placeholder="Reference" required>
      <input type="number" id="refcontact" placeholder="Reference Contact" required>
      <input type="text" id="refadd" placeholder="Reference Address" required>
      <input type="text" id="dateofjoining" placeholder="Date of Joining" required>
      <input type="number" id="salary" placeholder="Salary" required>

      <select id="status" required>
        <option value="" disabled selected>Select Status</option>
        <option value="Active">Active</option>
        <option value="Inactive">Inactive</option>
      </select>

      <label for="employeeDocs">Upload Documents</label>
      <input type="file" id="employeeDocs" accept="image/*,application/pdf" multiple />

      <div class="form-actions">
        <button type="button" class="btn" onclick="handleAddOrUpdate()">Add / Save Employee</button>
        <button type="button" class="btn" onclick="hideEmployeeForm()" style="background-color:#dc3545;">Cancel</button>
      </div>
    </form>
  </div>

  <h3>Import from Excel</h3>
  <input type="file" id="excelFile" accept=".xlsx" />
  <button class="btn" onclick="importFromExcel()">Import Excel</button><br>
  <button class="btn" onclick="toggleTable()">Show/Hide Employee Table</button>

  <br><br>
  <button class="btn" onclick="exportFiltered('All')">Export All</button>
  <button class="btn" onclick="exportFiltered('Active')">Export Active</button>
  <button class="btn" onclick="exportFiltered('Inactive')">Export Inactive</button>

  <h3>Admin Actions</h3>
  <input type="password" id="deletePassword" placeholder="Enter password to delete all record" />
  <button class="btn" style="background-color:#dc3545;" onclick="deleteAllEmployees()">Delete Record</button>

  <div id="employeeTableContainer" class="hidden">
    <h2>Employee Records</h2>
    <div id="employeeList"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <script>
    const githubToken = ''; // ðŸ”’ Leave blank for view-only, paste your token for edit mode
    const owner = 'Hamza123455';
    const repo = 'masterfile';
    const filePath = 'employees.json';
    const docsBasePath = 'documents';
    let employees = [];
    let editingIndex = -1;
    let employeePassword = "";
    const hasEditAccess = githubToken.trim() !== '';

    // Show banner for mode
    window.onload = () => {
      const banner = document.getElementById('modeBanner');
      if (hasEditAccess) {
        banner.textContent = 'âœ… Edit Mode (Full Access)';
        banner.style.backgroundColor = '#28a745';
      } else {
        banner.textContent = 'ðŸ”’ View-Only Mode';
        banner.style.backgroundColor = '#6c757d';
      }
      loadEmployees();
    };

    async function loadEmployees() {
      try {
        const url = `https://api.github.com/repos/${owner}/${repo}/contents/${filePath}`;
        const options = hasEditAccess ? { headers: { 'Authorization': `token ${githubToken}` } } : {};
        const res = await fetch(url, options);
        if (!res.ok) return alert('Unable to load data');
        const data = await res.json();
        const jsonData = JSON.parse(atob(data.content));
        employees = jsonData.employees || [];
        employeePassword = jsonData.password || "";
        renderEmployeeList();
        if (!hasEditAccess) disableEditFunctions();
      } catch (e) {
        console.error(e);
      }
    }

    function disableEditFunctions() {
      document.getElementById('showFormBtn').style.display = 'none';
      document.getElementById('deletePassword').disabled = true;
      document.querySelectorAll('.btn').forEach(b => {
        if (b.textContent.match(/Add|Save|Delete|Import/i)) {
          b.disabled = true;
          b.style.opacity = '0.5';
          b.style.cursor = 'not-allowed';
        }
      });
    }

    async function updateGitHubFile() {
      if (!hasEditAccess) {
        alert('View-only mode: cannot save');
        return;
      }
      try {
        const url = `https://api.github.com/repos/${owner}/${repo}/contents/${filePath}`;
        const getRes = await fetch(url, { headers: { 'Authorization': `token ${githubToken}` } });
        const getJson = await getRes.json();
        const sha = getJson.sha;
        const body = {
          message: "Update employee list",
          content: btoa(JSON.stringify({ password: employeePassword, employees }, null, 2)),
          sha
        };
        await fetch(url, {
          method: 'PUT',
          headers: {
            'Authorization': `token ${githubToken}`,
            'Accept': 'application/vnd.github.v3+json'
          },
          body: JSON.stringify(body)
        });
      } catch (err) {
        console.error(err);
      }
    }

    function renderEmployeeList() {
      const container = document.getElementById('employeeList');
      container.innerHTML = '';
      if (!employees.length) return container.innerHTML = '<p>No employee data available.</p>';
      const table = document.createElement('table');
      const header = table.insertRow();
      const fields = Object.keys(employees[0]);
      fields.forEach(k => {
        const th = document.createElement('th');
        th.textContent = k;
        header.appendChild(th);
      });
      const thA = document.createElement('th');
      thA.textContent = 'Actions';
      header.appendChild(thA);
      employees.forEach((e, i) => {
        const row = table.insertRow();
        fields.forEach(f => {
          const td = row.insertCell();
          td.textContent = e[f];
        });
        const act = row.insertCell();
        act.innerHTML = `
          <button class="btn" onclick="editEmployee(${i})">Edit</button>
          <button class="btn" style="background:#dc3545" onclick="deleteEmployee(${i})">Delete</button>`;
      });
      container.appendChild(table);
    }

    function showEmployeeForm(){ document.getElementById('employeeFormContainer').classList.remove('hidden'); document.getElementById('showFormBtn').style.display='none'; }
    function hideEmployeeForm(){ document.getElementById('employeeFormContainer').classList.add('hidden'); document.getElementById('showFormBtn').style.display='inline-block'; }
    function editEmployee(i){ if(!hasEditAccess)return; editingIndex=i; const emp=employees[i]; showEmployeeForm(); for(let k in emp){if(document.getElementById(k))document.getElementById(k).value=emp[k];}}
    async function deleteEmployee(i){ if(!hasEditAccess)return; if(!confirm('Delete?'))return; employees.splice(i,1); await updateGitHubFile(); renderEmployeeList(); }

    async function handleAddOrUpdate() {
      if (!hasEditAccess) return alert('View-only mode');
      const emp = {};
      document.querySelectorAll('#employeeForm input, #employeeForm select').forEach(el => emp[el.id] = el.value.trim());
      if (editingIndex >= 0) employees[editingIndex] = emp; else employees.push(emp);
      await updateGitHubFile();
      hideEmployeeForm();
      renderEmployeeList();
    }

    function toggleTable(){ document.getElementById('employeeTableContainer').classList.toggle('hidden'); renderEmployeeList(); }
    function importFromExcel(){ if(!hasEditAccess)return alert('View-only mode'); alert('Excel import function same as before'); }
    function exportFiltered(f){ alert('Export works same as before'); }
    function deleteAllEmployees(){ if(!hasEditAccess)return alert('View-only mode'); }
  </script>
</body>
</html>
