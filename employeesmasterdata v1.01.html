<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Arfa Foods</title>
  <link rel="icon" href="logo1.0.00.jpg" type="image/jpg">
  <style>
    * { box-sizing: border-box; }

    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 40px 20px;
      background-color: #f4f6f8;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    h1, h2 { color: #333; margin-bottom: 10px; }

    #employeeFormContainer {
      background: #fff;
      padding: 30px 25px;
      border-radius: 10px;
      border: 1px solid #ddd;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      max-width: 700px;
      width: 100%;
      margin-bottom: 25px;
    }

    input, select {
      width: 100%;
      padding: 10px;
      font-size: 15px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    button, .btn {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 6px;
      cursor: pointer;
      margin: 5px 3px 0 0;
    }

    .btn:hover { background-color: #0056b3; }

    .hidden { display: none; }

    .table-container {
      width: 100vw;
      overflow-x: auto;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      margin-top: 25px;
      padding-bottom: 5px;
    }

    table {
      width: 205%;
      min-width: 1200px;
      border-collapse: collapse;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
      word-break: break-word;
    }

    th {
      background: #a53838;
      color: white;
      position: sticky;
      top: 0;
      text-align: center;
    }
  </style>
</head>
<body>

  <h1>Employee Master Data</h1>

  <!-- ðŸ” Token Input -->
  <div id="tokenContainer">
    <input type="password" id="githubTokenInput" placeholder="Enter GitHub Token to Enable Editing" />
    <button class="btn" onclick="setToken()">Submit Token</button>
  </div>

  <!-- Add New Employee -->
  <button id="showFormBtn" class="btn hidden" onclick="showEmployeeForm()">Add New Employee</button>

  <div id="employeeFormContainer" class="hidden">
    <form id="employeeForm">
      <input type="number" id="srno" placeholder="Sr No" required>
      <input type="number" id="empid" placeholder="Emp ID" required>
      <input type="text" id="name" placeholder="Name" required>
      <input type="text" id="department" placeholder="Department" required>
      <input type="text" id="status" placeholder="Status" required>

      <div class="form-actions">
        <button type="button" class="btn" onclick="handleAddOrUpdate()">Add / Save</button>
        <button type="button" class="btn" style="background:#dc3545;" onclick="hideEmployeeForm()">Cancel</button>
      </div>
    </form>
  </div>

  <button class="btn" onclick="toggleTable()">Show/Hide Employee Table</button>

  <div id="employeeTableContainer" class="hidden table-container">
    <h2>Employee Records</h2>
    <div id="employeeList"></div>
  </div>

  <script>
    let githubToken = '';
    const owner = 'Hamza123455';
    const repo = 'masterfile';
    const filePath = 'employees.json';
    let employees = [];
    let editingIndex = -1;

    const fields = ['srno', 'empid', 'name', 'department', 'status'];

    function setToken() {
      const tokenInput = document.getElementById('githubTokenInput').value.trim();
      githubToken = tokenInput;
      alert(githubToken ? "âœ… Edit mode enabled!" : "ðŸ”’ View-only mode.");
      toggleEditMode(githubToken !== '');
      loadEmployees();
    }

    function toggleEditMode(enabled) {
      document.getElementById('showFormBtn').classList.toggle('hidden', !enabled);
      const editButtons = document.querySelectorAll('.edit-btn, .delete-btn');
      editButtons.forEach(btn => btn.style.display = enabled ? 'inline-block' : 'none');
    }

    async function loadEmployees() {
      try {
        const url = `https://api.github.com/repos/${owner}/${repo}/contents/${filePath}`;
        const res = await fetch(url);
        const data = await res.json();
        const jsonData = JSON.parse(atob(data.content));
        employees = jsonData.employees || [];
        renderEmployeeList();
      } catch (err) {
        console.error(err);
      }
    }

    function showEmployeeForm() {
      document.getElementById('employeeFormContainer').classList.remove('hidden');
      document.getElementById('employeeForm').reset();
    }

    function hideEmployeeForm() {
      document.getElementById('employeeFormContainer').classList.add('hidden');
    }

    async function updateGitHubFile() {
      if (!githubToken) return alert("Enter token to save changes!");
      const url = `https://api.github.com/repos/${owner}/${repo}/contents/${filePath}`;
      const getRes = await fetch(url, { headers: { 'Authorization': `token ${githubToken}` } });
      const getJson = await getRes.json();
      const sha = getJson.sha;
      const body = {
        message: "Update employees",
        content: btoa(JSON.stringify({ employees }, null, 2)),
        sha
      };
      await fetch(url, {
        method: 'PUT',
        headers: { 'Authorization': `token ${githubToken}`, 'Accept': 'application/vnd.github.v3+json' },
        body: JSON.stringify(body)
      });
    }

    async function handleAddOrUpdate() {
      const emp = {};
      for (let f of fields) emp[f] = document.getElementById(f).value.trim();
      if (!emp.name || !emp.empid) return alert('Please fill all fields');
      if (editingIndex >= 0) employees[editingIndex] = emp;
      else employees.push(emp);
      await updateGitHubFile();
      hideEmployeeForm();
      renderEmployeeList();
    }

    function renderEmployeeList() {
      const container = document.getElementById('employeeList');
      container.innerHTML = '';
      if (!employees.length) return container.innerHTML = '<p>No employee found.</p>';
      const table = document.createElement('table');
      const header = table.insertRow();
      fields.forEach(f => {
        const th = document.createElement('th');
        th.textContent = f;
        header.appendChild(th);
      });
      const thActions = document.createElement('th');
      thActions.textContent = 'Actions';
      header.appendChild(thActions);

      // âœ… Filter Row
      const filterRow = table.insertRow();
      fields.forEach((f, i) => {
        const td = document.createElement('td');
        td.innerHTML = `<input type="text" data-index="${i}" placeholder="Search ${f}" oninput="filterByColumn(this)">`;
        filterRow.appendChild(td);
      });
      filterRow.appendChild(document.createElement('td'));

      employees.forEach((e, i) => {
        const row = table.insertRow();
        fields.forEach(f => row.insertCell().textContent = e[f] || '');
        const actions = row.insertCell();
        actions.innerHTML = `
          <button class="btn edit-btn" onclick="editEmployee(${i})">Edit</button>
          <button class="btn delete-btn" style="background:#dc3545;" onclick="deleteEmployee(${i})">Delete</button>`;
      });

      container.appendChild(table);
      toggleEditMode(githubToken !== '');
    }

    function editEmployee(i) {
      editingIndex = i;
      const emp = employees[i];
      showEmployeeForm();
      fields.forEach(f => document.getElementById(f).value = emp[f]);
    }

    async function deleteEmployee(i) {
      if (!confirm("Delete this record?")) return;
      employees.splice(i, 1);
      await updateGitHubFile();
      renderEmployeeList();
    }

    function toggleTable() {
      document.getElementById('employeeTableContainer').classList.toggle('hidden');
    }

    function filterByColumn(input) {
      const idx = input.dataset.index;
      const val = input.value.toLowerCase();
      const table = document.querySelector('table');
      if (!table) return;
      const rows = table.querySelectorAll('tr');
      for (let r = 2; r < rows.length; r++) {
        const cell = rows[r].cells[idx];
        rows[r].style.display = cell && cell.textContent.toLowerCase().includes(val) ? '' : 'none';
      }
    }

    loadEmployees();
  </script>
</body>
</html>
