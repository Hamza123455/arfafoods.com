

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arfa Foods</title>
    <link rel="icon" href="logo1.0.00.jpg" type="image/jpg"> <!-- Favicon for tab -->
    <style>
         body {
                font-family: 'Times New Roman', serif;
                margin: 0;
                padding: 0;
                border: 2.5px solid #000; /* Full-page border */
                box-sizing: border-box; /* Ensure border is included in width/height */
              }
        p.MsoNormal {
                  margin-top: 0;
                 margin-right: 0;
                  margin-bottom: 8pt;
            margin-left: 0;
            line-height: 107%;
            font-size: 11pt;
            font-family: "Calibri", sans-serif;
        }
        .suggestions {
            border: 1px solid #ccc;
             max-height: 120px;
             overflow-y: auto;
             position: absolute;
             background: white;
             width: 300px;
             z-index: 1000;
        }

        .suggestions div {
            padding: 5px;
            cursor: pointer;
        }

        .suggestions div:hover {
             background-color: #eee;
        }

        p.MsoListParagraphCxSpFirst, p.MsoListParagraphCxSpLast {
            margin-top: 0;
            margin-right: 0;
            margin-bottom: 8pt;
            margin-left: 0.5in;
            line-height: 107%;
            font-size: 11pt;
            font-family: "Calibri", sans-serif;
        }
        p.MsoListParagraphCxSpFirst {
            margin-bottom: 0;
        }
        p.MsoListParagraphCxSpLast {
            margin-bottom: 8pt;
        }
        @media print {
            .print-date-time {
                position: absolute;
                top: 10mm;
                right: 10mm;
                font-size: 12px;
                color: #000;
            }
            body {
                margin: 0;
            }
        }
    </style>
</head>
<body>

<p class="MsoNormal">
    <span style="font-size: 12pt; line-height: 107%; font-family: 'Times New Roman', serif">
         &nbsp;
         Date 
        <input type="date" id="date" name="date" value="00-00-00">
    </span>
</p>

<p class="MsoNormal" align="center" style="text-align: center">
    <b><u>
        <span style="font-size: 18pt; line-height: 107%; font-family: 'Times New Roman', serif">
             LEAVE APPLICATION FORM
        </span>
    </u></b>
</p>

<p class="MsoNormal" style="line-height: 300%">
    <span style="font-size: 12pt; line-height: 300%; font-family: 'Times New Roman', serif">
        <div class="form-container">
            <div class="field-group">
              <label for="employee-name">Name:</label>
              <input type="text" id="employee-name" autocomplete="off" />
              <div id="suggestions" class="suggestions"></div>
            </div><br><br>
        <div class="field-group">
            <label for="contactNumber">Contact Number:</label>
                <input type="text" id="contactNumber" placeholder="03012345678" />
              </div>
            </div><br><br>   

        Department: 
    </span>
    <input list="department-names" id="department-name" name="department-name">
    <datalist id="department-names">
        <option value="CLEANING UNIT"></option>
        <option value="PACKING UNIT"></option>
        <option value="BARCODE TEAM"></option>
        <option value="SUPPLY UNIT"></option>
        <option value="GUARD"></option>
        <option value="COOK"></option>
        <option value="DRIVER"></option>
        <option value="PULSES SECTION"></option>
    </datalist>
</p>

<p class="MsoNormal" style="line-height: 300%">
    <span style="font-size: 12pt; line-height: 300%; font-family: 'Times New Roman', serif">
        &nbsp;
        Period of Leave: ________________
    </span>
</p>

<p class="MsoNormal" style="line-height: 300%">
    <span style="font-size: 12pt; line-height: 300%; font-family: 'Times New Roman', serif">
        &nbsp;
        Reason of Leave: ____________________
    </span>
</p>

<p class="MsoNormal" style="line-height: 300%">
    <span style="font-size: 12pt; line-height: 300%; font-family: 'Times New Roman', serif">
        &nbsp;
        Last Leave Date/Month: 
    </span>
    <input type="text" id="lastLeaveDate" name="lastLeaveDate" placeholder="Enter Date or Custom Text">
</p>

<p class="MsoListParagraphCxSpFirst" style="text-indent: -.25in; line-height: 150%; margin-left: 45pt">
    <span style="font-size: 12pt; line-height: 150%; font-family: Symbol">Â·</span>
    <b><u>
        <span style="font-size: 12pt; line-height: 150%; font-family: 'Times New Roman', serif">
            NOTE:
        </span>
    </u>
    <span style="font-size: 12pt; line-height: 150%; font-family: 'Times New Roman', serif">
        &nbsp;You are requested to follow the instructions for leave.
    </span></b>
</p>

<p class="MsoListParagraphCxSpLast" style="text-indent: -.25in; line-height: 150%; margin-left: 45pt">
    <span style="font-size: 12pt; line-height: 150%; font-family: Symbol">Â·</span>
    <b>
        <span style="font-size: 12pt; line-height: 150%; font-family: 'Times New Roman', serif">
            Employee can leave the warehouse after the Lunch break before the day of leave allocated and return at Lunch time after the leave finishes. Otherwise absent will be marked.
        </span>
    </b>
</p>
<!-- Urdu Notes Section -->
<p class="MsoListParagraphCxSpFirst" dir="rtl" style="text-indent: -.25in; line-height: 150%; margin-right: 45pt">
    <span style="font-size: 12pt; line-height: 150%; font-family: Symbol">Â·</span>
    <b><u>
        <span style="font-size: 12pt; line-height: 150%; font-family: 'Times New Roman', serif">
            Ù†ÙˆÙ¹:
        </span>
    </u>
    <span style="font-size: 12pt; line-height: 150%; font-family: 'Times New Roman', serif">
        &nbsp;Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø±Ø®ØµØª Ú©Û’ Ù„ÛŒÛ’ ÛØ¯Ø§ÛŒØ§Øª Ù¾Ø± Ø¹Ù…Ù„ Ú©Ø±ÛŒÚºÛ”
    </span></b>
</p>

<p class="MsoListParagraphCxSpLast" dir="rtl" style="text-indent: -.25in; line-height: 150%; margin-right: 45pt">
    <span style="font-size: 12pt; line-height: 150%; font-family: Symbol">Â·</span>
    <b>
        <span style="font-size: 12pt; line-height: 150%; font-family: 'Times New Roman', serif">
            Ù…Ù„Ø§Ø²Ù… Ø±Ø®ØµØª ÙˆØ§Ù„Û’ Ø¯Ù† Ø³Û’ Ø§ÛŒÚ© Ø¯Ù† Ù¾ÛÙ„Û’ Ø¯ÙˆÙ¾ÛØ± Ú©Û’ Ú©Ú¾Ø§Ù†Û’ Ú©Û’ ÙˆÙ‚ÙÛ’ Ú©Û’ Ø¨Ø¹Ø¯ Ú¯ÙˆØ¯Ø§Ù… Ú†Ú¾ÙˆÚ‘ Ø³Ú©ØªØ§ ÛÛ’ Ø§ÙˆØ± Ø­Ø§Ø¶Ø±ÛŒ ÙˆØ§Ù„Û’ Ø¯Ù† Ø¯ÙˆÙ¾ÛØ± Ú©Û’ Ú©Ú¾Ø§Ù†Û’ Ú©Û’ ÙˆÙ‚Øª ÙˆØ§Ù¾Ø³ Ø¢Ù†Ø§ Ø¶Ø±ÙˆØ±ÛŒ ÛÛ’Û” Ø¨ØµÙˆØ±Øª Ø¯ÛŒÚ¯Ø± ØºÛŒØ± Ø­Ø§Ø¶Ø±ÛŒ Ø´Ù…Ø§Ø± Ú©ÛŒ Ø¬Ø§Ø¦Û’ Ú¯ÛŒÛ”
        </span>
    </b>
</p>
<p class="MsoNormal" style="line-height: 300%">
    <span style="font-size: 12pt; line-height: 300%; font-family: 'Times New Roman', serif">
            &nbsp; <u>Employees Signature: ________________________ </u>
        </span>
</p>

<p class="MsoNormal" style="line-height: 300%">
    <span style= "fontsize: 12px; font-family: 'Times New Roman', serif">&nbsp;
	</span>
	<span style="font-size: 12pt; line-height: 300%; font-family: 'Times New Roman', serif">
            <u>Supervisor Approval: </u> 
        </span>
    <span style="font-size: 12pt; line-height: 300%; font-family: 'Times New Roman', serif">
        &nbsp;&nbsp;_____________________________
    </span>
</p>

<p class="MsoNormal" style="line-height: 300%">
    <b>
        <span style="font-size: 15pt; line-height: 300%; font-family: 'Times New Roman', serif">
            &nbsp;
            Manager Approval
        </span>
    </b>
    <span style="font-size: 12pt; line-height: 300%; font-family: 'Times New Roman', serif">
        : ________________________
    </span>
</p>

<div class="print-date-time"></div>

<!-- âœ… BUTTONS -->
<div class="buttons-container" style="margin:20px;">
  <button onclick="saveToSheet()" style="font-size:16px;">Save Data</button>
  <button onclick="saveAndPrint()" style="font-size:16px;">Print</button>
  <input type="hidden" id="employee-id">
</div>
<div id="leaveDialog" style="
  display:none;
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.5);
  z-index:9999;
">
  <div style="
    background:#fff;
    width:320px;
    margin:10% auto;
    padding:15px;
    border-radius:6px;
  ">
    <h3>Select Last Leave Date</h3>
    <div id="leaveList"></div>
    <br>
    <button onclick="closeLeaveDialog()">Cancel</button>
  </div>
</div>

<script>
const employeeInput = document.getElementById('employee-name');
const contactInput = document.getElementById('contactNumber');
const suggestionBox = document.getElementById('suggestions');

let employees = [];

const GITHUB_JSON_URL = 'https://raw.githubusercontent.com/Hamza123455/masterfile/main/employees.json';
const GOOGLE_SHEET_WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbxX8GDhvPBDLHnv2wMoCaa7ZY3GEPg5YnbRKrsY1Q9yFGifUwVE4mP7nRa25D5iJdPPqw/exec';

// Fetch employee data
fetch(GITHUB_JSON_URL)
  .then(response => response.json())
  .then(data => employees = data.employees);

employeeInput.addEventListener('input', function () {
  const value = this.value.trim().toLowerCase();
  suggestionBox.innerHTML = '';
  if (!value) return;

  const matches = employees.filter(emp =>
    emp.name.toLowerCase().includes(value)
  );

  matches.forEach(emp => {
    const div = document.createElement('div');

    // âœ… Show: Name_FatherName
    div.textContent = `${emp.name}_${emp.fathername || ''}`;

    div.addEventListener('click', () => {
  employeeInput.value = emp.name;
  contactInput.value = emp.empcontactno || '';
  document.getElementById('employee-id').value = emp.empid || '';
  suggestionBox.innerHTML = '';

  // ğŸ”¥ FETCH ALL LAST LEAVES
  fetchLastLeaves(emp.empid);
});

    suggestionBox.appendChild(div);
  });
});

document.addEventListener('click', function (e) {
  if (!suggestionBox.contains(e.target) && e.target !== employeeInput) {
    suggestionBox.innerHTML = '';
  }
});
function fetchLastLeaves(empid) {
  fetch(`${GOOGLE_SHEET_WEBAPP_URL}?empid=${empid}`)
    .then(res => res.json())
    .then(dates => {
      if (!dates.length) return;

      const list = document.getElementById('leaveList');
      list.innerHTML = '';
dates.forEach(item => {
  const div = document.createElement('div');
  div.style.padding = '8px';
  div.style.borderBottom = '1px solid #ccc';
  div.style.cursor = 'pointer';

  // âœ… DATE (COLUMN B) IS PRIMARY
  div.innerHTML = `
    <strong>Date Selected:</strong> ${item.date}<br>
    <span style="color:#555">
      Last Leave Date: ${item.lastLeaveDate}
    </span>
  `;

  div.onclick = () => {
    // âœ… Only Column G is written to input
    document.getElementById('lastLeaveDate').value = item.lastLeaveDate;
    closeLeaveDialog();
  };

  list.appendChild(div);
});


      document.getElementById('leaveDialog').style.display = 'block';
    });
}

function closeLeaveDialog() {
  document.getElementById('leaveDialog').style.display = 'none';
}

// âœ… Save data to Google Sheet
function saveToSheet() {
  const date = document.getElementById('date').value;
  const empid = document.getElementById('employee-id').value;
  const name = document.getElementById('employee-name').value;
  const contact = document.getElementById('contactNumber').value;
  const department = document.getElementById('department-name').value;
  const lastLeaveDate = document.getElementById('lastLeaveDate').value;

  if (!name || !contact || !lastLeaveDate) {
    alert("Please fill in all required fields before saving.");
    return;
  }

  const data = { date, empid, name, contact, department, lastLeaveDate };

  fetch(GOOGLE_SHEET_WEBAPP_URL, {
    method: 'POST',
    mode: 'no-cors',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  })
  .then(() => alert("âœ… Data saved to Google Sheet successfully!"))
  .catch(err => alert("âŒ Error saving data: " + err));
}

// âœ… Save data and then print the form
function saveAndPrint() {
  const buttons = document.querySelector('.buttons-container');
  const date = document.getElementById('date').value;
  const empid = document.getElementById('employee-id').value;
  const name = document.getElementById('employee-name').value;
  const contact = document.getElementById('contactNumber').value;
  const department = document.getElementById('department-name').value;
  const lastLeaveDate = document.getElementById('lastLeaveDate').value;

  if (!name || !contact || !lastLeaveDate) {
    alert("Please fill in all required fields before printing.");
    return;
  }

  const data = { date, empid, name, contact, department, lastLeaveDate };

  fetch(GOOGLE_SHEET_WEBAPP_URL, {
    method: 'POST',
    mode: 'no-cors',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  })
  .then(() => {
    // Hide buttons before print
    buttons.style.display = 'none';
    setTimeout(() => {
      window.print();
      // Show buttons again after printing
      setTimeout(() => { buttons.style.display = 'block'; }, 1000);
    }, 800);
  })
  .catch(err => alert("âŒ Error saving data: " + err));
}

// Show date and time on print
function updatePrintDateTime() {
  const now = new Date();
  const formattedDate = now.toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' });
  const formattedTime = now.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
  document.querySelector('.print-date-time').textContent = `Printed on: ${formattedDate} ${formattedTime}`;
}

updatePrintDateTime();
setInterval(updatePrintDateTime, 1000);
</script>

</body>
</html>

